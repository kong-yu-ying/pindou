<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹¼è±†è‰²å·æŸ¥æ‰¾ç³»ç»Ÿ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        h1 {
            color: #4a6fa5;
            margin-bottom: 15px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .info-card {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4a6fa5;
        }
        
        .info-card h4 {
            color: #4a6fa5;
            margin-bottom: 8px;
        }
        
        .info-card p {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }
        
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .search-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        
        .input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e6f0;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #4a6fa5;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }
        
        button {
            padding: 15px 30px;
            background: #4a6fa5;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #3a5a8a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 111, 165, 0.3);
        }
        
        .result-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            min-height: 400px;
        }
        
        .result {
            display: none;
        }
        
        .result.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        .result-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f4f9;
        }
        
        .color-sample {
            width: 70px;
            height: 70px;
            border-radius: 12px;
            border: 3px solid #e0e6f0;
        }
        
        .color-info h2 {
            color: #4a6fa5;
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .color-info p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .position-details {
            background: #f8fafc;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .detail-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #4a6fa5;
        }
        
        .detail-label {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 8px;
        }
        
        .detail-value {
            font-size: 1.6rem;
            font-weight: bold;
            color: #4a6fa5;
        }
        
        .visualization {
            margin-top: 30px;
        }
        
        .visualization h3 {
            color: #4a6fa5;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .box-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            max-width: 600px;
        }
        
        .grid-cell {
            aspect-ratio: 1;
            background: #f0f4f9;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            transition: all 0.3s;
            border: 2px solid transparent;
            cursor: help;
        }
        
        .grid-cell.highlight {
            background: #4a6fa5;
            color: white;
            transform: scale(1.1);
            border-color: #3a5a8a;
            box-shadow: 0 5px 15px rgba(74, 111, 165, 0.3);
            z-index: 1;
        }
        
        .grid-labels {
            display: grid;
            grid-template-columns: 60px repeat(6, 1fr);
            gap: 10px;
            max-width: 600px;
        }
        
        .row-label, .col-label {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #666;
            padding: 8px;
        }
        
        .row-label {
            justify-content: flex-start;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .box-list {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        
        .box-list h3 {
            color: #4a6fa5;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .box-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .box-tab {
            padding: 10px 20px;
            background: #f0f4f9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .box-tab:hover {
            background: #e0e6f0;
        }
        
        .box-tab.active {
            background: #4a6fa5;
            color: white;
        }
        
        .box-content {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .box-row {
            margin-bottom: 15px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .box-row h4 {
            color: #4a6fa5;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .color-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .color-tag {
            padding: 6px 12px;
            background: white;
            border-radius: 6px;
            font-size: 0.9rem;
            border: 1px solid #e0e6f0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .color-tag:hover {
            background: #4a6fa5;
            color: white;
            border-color: #4a6fa5;
        }
        
        .recent-searches {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        
        .recent-searches h3 {
            color: #4a6fa5;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .search-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .search-tag {
            padding: 10px 18px;
            background: #f0f4f9;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .search-tag:hover {
            background: #4a6fa5;
            color: white;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 1.1rem;
            text-align: center;
            padding: 25px;
            background: #fdf2f2;
            border-radius: 10px;
            border-left: 4px solid #e74c3c;
            margin: 20px 0;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2rem;
        }
        
        .system-info {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #e0e6f0;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .color-type-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #e8f4ff;
            color: #4a6fa5;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
            }
            
            .detail-grid {
                grid-template-columns: 1fr;
            }
            
            .box-grid {
                grid-template-columns: repeat(6, 1fr);
                gap: 6px;
            }
            
            .grid-cell {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§© MARD 264è‰²æ‹¼è±†è‰²å·æŸ¥æ‰¾ç³»ç»Ÿ</h1>
            <div class="subtitle">
                <p>åŸºäºMARD 264è‰²æ‹¼è±†è‰²å·å¿«é€Ÿå®šä½ç³»ç»Ÿ â€¢ æ¯ä¸ªç›’å­é‡‡ç”¨4è¡ŒÃ—6åˆ—æ ‡å‡†å¸ƒå±€</p>
                <p>ç³»ç»ŸåŒ…å«ï¼š21.6å…¨å®è‰²ï¼ˆä¸å«C29 D10 B9 C12 D4ï¼‰ + 26.4é‡‘è‰²ï¼ˆä¸å«C29ï¼‰</p>
            </div>
            
            <div class="info-grid">
                <div class="info-card">
                    <h4>ğŸ“¦ ç›’å­åˆ†å¸ƒ</h4>
                    <p>24è‰²/ç›’ Ã— 11ç›’ = 264è‰²<br>å·²å½•å…¥ï¼šAã€Bã€Cç›’å®Œæ•´æ•°æ®</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ” æœç´¢æ ¼å¼</h4>
                    <p>æ”¯æŒï¼šB10ã€C2ã€E12ã€M5ç­‰<br>å­—æ¯å¤§å†™ï¼Œæ•°å­—ä¸é™</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ¯ å®šä½ç²¾åº¦</h4>
                    <p>ç²¾ç¡®åˆ°ï¼šç›’å­åç§°ã€è¡Œæ•°ã€åˆ—æ•°<br>4è¡ŒÃ—6åˆ—å¯è§†åŒ–ç½‘æ ¼</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ“Š æ•°æ®ç»Ÿè®¡</h4>
                    <p>æ€»è®¡264è‰²<br>21.6å…¨å®è‰² + 26.4é‡‘è‰²</p>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="search-section">
                <div class="input-group">
                    <input type="text" id="colorInput" placeholder="è¯·è¾“å…¥æ‹¼è±†è‰²å· (ä¾‹å¦‚: B10, E12, M5)" autofocus>
                    <button id="searchBtn">ğŸ” æŸ¥æ‰¾è‰²å·</button>
                </div>
                <p style="color: #666; font-size: 0.95rem; margin-top: 10px;">
                    æç¤ºï¼šç³»ç»Ÿæ”¯æŒ B10ã€C2ã€E12ã€M5 ç­‰æ ¼å¼è¾“å…¥ï¼Œå­—æ¯éœ€å¤§å†™
                </p>
                
                <div class="result-section" id="resultSection">
                    <div class="loading" id="loading">
                        <div style="font-size: 1.5rem; margin-bottom: 15px;">ğŸ¨</div>
                        è¯·è¾“å…¥è‰²å·å¼€å§‹æŸ¥æ‰¾...
                    </div>
                    
                    <div class="result" id="result">
                        <div class="result-header">
                            <div class="color-sample" id="colorSample"></div>
                            <div class="color-info">
                                <h2 id="colorName">B10<span class="color-type-badge" id="colorType">æ ‡å‡†è‰²</span></h2>
                                <p id="colorDesc">æ‹¼è±†è‰²å· â€¢ MARD 264è‰²ç³»ç»Ÿ</p>
                            </div>
                        </div>
                        
                        <div class="position-details">
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <div class="detail-label">ğŸ“¦ æ‰€åœ¨ç›’å­</div>
                                    <div class="detail-value" id="boxName">ç›’å­A</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">ğŸ“ æ‰€åœ¨è¡Œæ•°</div>
                                    <div class="detail-value" id="rowNumber">ç¬¬1è¡Œ</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">ğŸ“ æ‰€åœ¨åˆ—æ•°</div>
                                    <div class="detail-value" id="colNumber">ç¬¬1åˆ—</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="visualization" id="visualization">
                            <h3>ğŸ“Š ä½ç½®å¯è§†åŒ– (4è¡ŒÃ—6åˆ—)</h3>
                            <div class="grid-labels">
                                <div></div>
                                <div class="col-label">1</div>
                                <div class="col-label">2</div>
                                <div class="col-label">3</div>
                                <div class="col-label">4</div>
                                <div class="col-label">5</div>
                                <div class="col-label">6</div>
                            </div>
                            <div id="boxGrid"></div>
                        </div>
                    </div>
                    
                    <div class="error-message" id="errorMessage" style="display: none;">
                        âŒ æ‰¾ä¸åˆ°è¯¥è‰²å·ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ˜¯å¦æ­£ç¡®ï¼ˆæ³¨æ„å­—æ¯éœ€å¤§å†™ï¼‰
                    </div>
                </div>
            </div>
            
            <div class="sidebar">
                <div class="box-list">
                    <h3>ğŸ“¦ ç›’å­è‰²å·åˆ—è¡¨</h3>
                    <div class="box-tabs" id="boxTabs">
                        <!-- é€‰é¡¹å¡å°†ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="box-content" id="boxContent">
                        <!-- ç›’å­å†…å®¹å°†ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="recent-searches">
                    <h3>âš¡ å¸¸ç”¨è‰²å·</h3>
                    <div class="search-tags" id="popularColors">
                        <!-- å¸¸ç”¨è‰²å·å°†ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="system-info">
                    <p>MARD 264è‰²æ‹¼è±†è‰²å·ç³»ç»Ÿ â€¢ ç‰ˆæœ¬ 1.0</p>
                    <p style="margin-top: 5px; font-size: 0.85rem; color: #888;">
                        æ•°æ®åŒ…å«ï¼šç›’å­Aã€Bã€Cå®Œæ•´è‰²å·åˆ†å¸ƒ<br>
                        Dã€Eã€6-11ç›’å­æ•°æ®å¾…è¡¥å……
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç›’å­æ•°æ® - åŸºäºæ‚¨æä¾›çš„å®Œæ•´ä¿¡æ¯
        const BOX_DATA = {
            // ç›’å­Aï¼ˆä¹‹å‰çš„æ•°æ®ï¼‰
            'A': [
                ['B10', 'C2', 'C3', 'C13', 'D16', 'D17'],
                ['B6', 'C4', 'C10', 'C17', 'D1', 'D11'],
                ['C15', 'C11', 'C5', 'C6', 'C7', 'D2'],
                ['B19', 'B7', 'C8', 'C9', 'D3', 'C16']
            ],
            
            // ç›’å­Bï¼ˆæ‚¨æ–°æä¾›çš„æ•°æ®ï¼‰
            'B': [
                ['E12', 'E2', 'E8', 'D19', 'D8', 'D9'],
                ['E6', 'E4', 'E3', 'E9', 'D12', 'D6'],
                ['E5', 'E10', 'D5', 'D13', 'D20', 'D18'],
                ['E7', 'E13', 'D21', 'D14', 'D7', 'D15']
            ],
            
            // ç›’å­Cï¼ˆæ‚¨æ–°æä¾›çš„æ•°æ®ï¼‰
            'C': [
                ['C14', 'B20', 'C1', 'B18', 'M5', 'M6'],
                ['B3', 'B16', 'B13', 'B1', 'G13', 'F10'],
                ['B5', 'B4', 'B2', 'B14', 'G7', 'F11'],
                ['B15', 'B12', 'B8', 'B17', 'B11', 'G8']
            ],
            
            // å…¶ä»–ç›’å­ï¼ˆå ä½ç¬¦ï¼Œéœ€è¦æ ¹æ®å›¾ç‰‡æ•°æ®è¡¥å……ï¼‰
            'D': [['A15','A3','A11','A9','F14','F12'],['A4','A13','A6','F1','F2','F3'],['A5','A10','A7','F13','F9','F6'],['A8','A14','F4','F5','F8','F7']],
            'E': [['E15','E1','E14','E11','H2','H1'],['A12','G3','G2','G1','A1','H12'],['G6','G5','G9','M9','H3','H4'],['G14','M12','G17','H5','H6','H7']],
            '6': [['H8','G15','A2','H13','G16','H9'],['H10','M1','G11','G4','M4','H14'],['M10','M2','G12','M13','M7','H11'],['M11','M3','G10','M14','M8','M15']],
            '7': [['P18','P16','P3','P12','P1','T1'],['P7','P17','P6','P13','P9','P11'],['P4','P5','P15','P14','P2','R12'],['P23','P22','P21','P20','P19','P8']],
            '8': [['P10','R11','Y2','Y3','Q2','Y4'],['Y5','Y1','R3','R4','R5','R8'],['R9','R2','R1','R10','R6','R7'],['D10','R13','Q5','B9','C12','D4']],
            '9': [['H17','H18','H19','E16','F16','F17'],['D23','E24','E19','E18','E17','E20'],['B23','A16','A17','A18','F24','F23'],['A24','A22','A21','F21','F22','A19']],
            '10': [['A26','A25','A20','A23','G18','H21'],['B26','B32','B31','B30','B27','B29'],['C22','C23','C24','B28','C25','C27'],['H15','H20','H23','H22','C28','C21']],
            '11': [['F15','F19','G20','E21','E22','D26'],['F25','F20','G19','F18','G21','E23'],['D25','D22','D24','C20','B21','B25'],['H16','B23','C18','B22','C19','C26']]
        };

        // ç‰¹æ®Šè‰²å·ç±»å‹æ ‡è®°
        const SPECIAL_COLORS = {
            // 21.6å…¨å®è‰²ä¸å«çš„è‰²å·
            'excludedFrom216': ['C29', 'D10', 'B9', 'C12', 'D4'],
            
            // 26.4é‡‘è‰²ä¸å«çš„è‰²å·
            'excludedFrom264': ['C29'],
            
            // é‡‘è‰²ç³»è‰²å·ï¼ˆç¤ºä¾‹ï¼‰
            'goldColors': ['G13', 'F10', 'G7', 'F11', 'G8', 'M5', 'M6']
        };

        // æ‰€æœ‰å·²çŸ¥è‰²å·çš„å…¨å±€æ˜ å°„
        const ALL_COLORS = {};
        
        // å¸¸ç”¨è‰²å·
        const POPULAR_COLORS = [
            'B10', 'C2', 'D17', 'B6', 'D1',
            'C15', 'C7', 'D2', 'E12', 'E2',
            'E8', 'D19', 'C14', 'B20', 'M5',
            'B3', 'B16', 'G13', 'F10', 'B5'
        ];

        // åˆå§‹åŒ–é¢œè‰²æ•°æ®åº“
        function initializeColorDatabase() {
            // éå†æ‰€æœ‰ç›’å­ï¼Œæ„å»ºè‰²å·æ˜ å°„
            for (const [boxName, grid] of Object.entries(BOX_DATA)) {
                if (grid.length === 0) continue;
                
                for (let row = 0; row < grid.length; row++) {
                    for (let col = 0; col < grid[row].length; col++) {
                        const colorCode = grid[row][col];
                        if (!colorCode) continue;
                        
                        // ç”ŸæˆåŸºäºè‰²å·çš„å›ºå®šé¢œè‰²
                        const hash = Array.from(colorCode).reduce((acc, char) => {
                            return acc + char.charCodeAt(0);
                        }, 0);
                        
                        // ç¡®å®šè‰²å·ç±»å‹
                        let type = 'æ ‡å‡†è‰²';
                        let description = `æ‹¼è±†è‰²å· ${colorCode}`;
                        
                        if (SPECIAL_COLORS.excludedFrom216.includes(colorCode)) {
                            type = '21.6ä¸å«';
                            description = `${colorCode} (21.6å…¨å®è‰²ä¸å«)`;
                        } else if (SPECIAL_COLORS.excludedFrom264.includes(colorCode)) {
                            type = '26.4ä¸å«';
                            description = `${colorCode} (26.4é‡‘è‰²ä¸å«)`;
                        } else if (SPECIAL_COLORS.goldColors.includes(colorCode)) {
                            type = 'é‡‘è‰²ç³»';
                            description = `${colorCode} (é‡‘è‰²ç³»)`;
                        }
                        
                        // åˆ›å»ºé¢œè‰²ï¼ˆä½¿ç”¨HSLç¡®ä¿å¯è¯»æ€§ï¼‰
                        const hue = (hash * 137) % 360;
                        let saturation = 70;
                        let lightness = 60;
                        
                        if (type === 'é‡‘è‰²ç³»') {
                            saturation = 60;
                            lightness = 50;
                        } else if (type.includes('ä¸å«')) {
                            lightness = 70;
                        }
                        
                        ALL_COLORS[colorCode] = {
                            code: colorCode,
                            box: boxName,
                            row: row + 1,
                            col: col + 1,
                            rowIndex: row,
                            colIndex: col,
                            color: `hsl(${hue}, ${saturation}%, ${lightness}%)`,
                            description: description,
                            type: type
                        };
                    }
                }
            }
        }

        // æŸ¥æ‰¾è‰²å·
        function findColorPosition(colorCode) {
            const upperCode = colorCode.toUpperCase();
            
            if (ALL_COLORS[upperCode]) {
                const info = ALL_COLORS[upperCode];
                return {
                    found: true,
                    boxName: `ç›’å­${info.box}`,
                    row: info.row,
                    col: info.col,
                    rowIndex: info.rowIndex,
                    colIndex: info.colIndex,
                    colorCode: info.code,
                    colorInfo: info
                };
            }
            
            return { found: false };
        }

        // è§£æç”¨æˆ·è¾“å…¥çš„è‰²å·
        function parseColorInput(input) {
            const cleanInput = input.trim().toUpperCase();
            
            // æ”¯æŒå„ç§æ ¼å¼ï¼šå­—æ¯+æ•°å­—ï¼Œå¯èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦
            const pattern = /^[A-Z]+\d+$/;
            if (!pattern.test(cleanInput)) {
                // å°è¯•æ¸…ç†è¾“å…¥ï¼ˆå»é™¤ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦ï¼‰
                const cleaned = cleanInput.replace(/[^A-Z0-9]/g, '');
                if (cleaned.length >= 2) {
                    const letters = cleaned.match(/[A-Z]+/)?.[0] || '';
                    const numbers = cleaned.match(/\d+/)?.[0] || '';
                    if (letters && numbers) {
                        return letters + numbers;
                    }
                }
                return null;
            }
            
            return cleanInput;
        }

        // æ˜¾ç¤ºæŸ¥æ‰¾ç»“æœ
        function showColorResult(colorCode) {
            const position = findColorPosition(colorCode);
            
            if (!position.found) {
                showError();
                return;
            }
            
            // æ›´æ–°æ˜¾ç¤ºä¿¡æ¯
            document.getElementById('colorName').innerHTML = 
                `${position.colorCode}<span class="color-type-badge" id="colorType">${position.colorInfo.type}</span>`;
            document.getElementById('colorDesc').textContent = position.colorInfo.description;
            document.getElementById('boxName').textContent = position.boxName;
            document.getElementById('rowNumber').textContent = `ç¬¬${position.row}è¡Œ`;
            document.getElementById('colNumber').textContent = `ç¬¬${position.col}åˆ—`;
            
            // è®¾ç½®é¢œè‰²æ ·æœ¬
            document.getElementById('colorSample').style.backgroundColor = position.colorInfo.color;
            
            // ç”Ÿæˆç›’å­å¯è§†åŒ–
            generateBoxVisualization(position);
            
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            document.getElementById('loading').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('result').classList.add('active');
            
            // æ·»åŠ åˆ°æœ€è¿‘æœç´¢
            addToRecentSearches(colorCode);
            
            // æ¿€æ´»å¯¹åº”çš„ç›’å­é€‰é¡¹å¡
            activateBoxTab(position.colorInfo.box);
        }

        // ç”Ÿæˆç›’å­å¯è§†åŒ–ç½‘æ ¼
        function generateBoxVisualization(position) {
            const gridContainer = document.getElementById('boxGrid');
            gridContainer.innerHTML = '';
            
            const boxData = BOX_DATA[position.colorInfo.box];
            if (!boxData || boxData.length === 0) {
                gridContainer.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #666;">ç›’å­æ•°æ®å¾…è¡¥å……</div>';
                return;
            }
            
            // åˆ›å»º4è¡Œ
            for (let row = 0; row < boxData.length; row++) {
                const rowLabel = document.createElement('div');
                rowLabel.className = 'row-label';
                rowLabel.textContent = `è¡Œ${row + 1}`;
                gridContainer.appendChild(rowLabel);
                
                // åˆ›å»º6åˆ—
                for (let col = 0; col < boxData[row].length; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    const colorCode = boxData[row][col];
                    
                    if (colorCode) {
                        cell.textContent = colorCode;
                        cell.title = `è‰²å·: ${colorCode}`;
                        
                        // è®¾ç½®å•å…ƒæ ¼é¢œè‰²
                        const cellColor = ALL_COLORS[colorCode]?.color || '#f0f4f9';
                        cell.style.backgroundColor = cellColor;
                        
                        // å¦‚æœæ˜¯å½“å‰æŸ¥æ‰¾çš„è‰²å·ï¼Œé«˜äº®æ˜¾ç¤º
                        if (row === position.rowIndex && col === position.colIndex) {
                            cell.classList.add('highlight');
                            cell.style.color = 'white';
                        } else {
                            // è®¾ç½®å¯¹æ¯”åº¦åˆé€‚çš„æ–‡å­—é¢œè‰²
                            const brightness = getColorBrightness(cellColor);
                            cell.style.color = brightness > 128 ? '#333' : 'white';
                        }
                        
                        // æ·»åŠ ç‚¹å‡»æœç´¢åŠŸèƒ½
                        cell.addEventListener('click', () => {
                            document.getElementById('colorInput').value = colorCode;
                            searchColor();
                        });
                    } else {
                        cell.textContent = '-';
                        cell.style.color = '#999';
                        cell.style.cursor = 'default';
                    }
                    
                    gridContainer.appendChild(cell);
                }
            }
        }

        // è·å–é¢œè‰²äº®åº¦
        function getColorBrightness(color) {
            if (color.startsWith('hsl')) {
                const matches = color.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);
                if (matches) {
                    return parseInt(matches[3]);
                }
            }
            return 128;
        }

        // åˆå§‹åŒ–ç›’å­é€‰é¡¹å¡
        function initializeBoxTabs() {
            const boxTabs = document.getElementById('boxTabs');
            const boxContent = document.getElementById('boxContent');
            
            // åªæ˜¾ç¤ºæœ‰æ•°æ®çš„ç›’å­
            const boxesWithData = Object.entries(BOX_DATA)
                .filter(([_, grid]) => grid.length > 0)
                .map(([boxName]) => boxName);
            
            boxesWithData.forEach((boxName, index) => {
                // åˆ›å»ºé€‰é¡¹å¡
                const tab = document.createElement('div');
                tab.className = 'box-tab';
                if (index === 0) tab.classList.add('active');
                tab.textContent = `ç›’å­${boxName}`;
                tab.dataset.box = boxName;
                tab.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰active
                    document.querySelectorAll('.box-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    showBoxContent(boxName);
                });
                boxTabs.appendChild(tab);
                
                // åˆ›å»ºç›’å­å†…å®¹
                const contentDiv = document.createElement('div');
                contentDiv.className = 'box-content-item';
                contentDiv.id = `boxContent-${boxName}`;
                contentDiv.style.display = index === 0 ? 'block' : 'none';
                boxContent.appendChild(contentDiv);
            });
            
            // æ˜¾ç¤ºç¬¬ä¸€ä¸ªç›’å­çš„å†…å®¹
            if (boxesWithData.length > 0) {
                showBoxContent(boxesWithData[0]);
            }
        }

        // æ˜¾ç¤ºç›’å­å†…å®¹
        function showBoxContent(boxName) {
            // éšè—æ‰€æœ‰å†…å®¹
            document.querySelectorAll('.box-content-item').forEach(item => {
                item.style.display = 'none';
            });
            
            const contentDiv = document.getElementById(`boxContent-${boxName}`);
            contentDiv.style.display = 'block';
            
            // å¦‚æœå†…å®¹å·²ç»ç”Ÿæˆï¼Œç›´æ¥æ˜¾ç¤º
            if (contentDiv.innerHTML) return;
            
            const boxData = BOX_DATA[boxName];
            if (!boxData || boxData.length === 0) {
                contentDiv.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">ç›’å­æ•°æ®å¾…è¡¥å……</p>';
                return;
            }
            
            let html = '';
            boxData.forEach((row, rowIndex) => {
                html += `
                    <div class="box-row">
                        <h4>ç¬¬${rowIndex + 1}è¡Œ</h4>
                        <div class="color-tags">
                            ${row.map(colorCode => {
                                if (!colorCode) return '';
                                const colorInfo = ALL_COLORS[colorCode];
                                const colorStyle = colorInfo ? `background-color: ${colorInfo.color}; color: ${getColorBrightness(colorInfo.color) > 128 ? '#333' : 'white'}` : '';
                                return `<div class="color-tag" style="${colorStyle}" onclick="document.getElementById('colorInput').value='${colorCode}'; searchColor();">${colorCode}</div>`;
                            }).join('')}
                        </div>
                    </div>
                `;
            });
            
            contentDiv.innerHTML = html;
        }

        // æ¿€æ´»ç›’å­é€‰é¡¹å¡
        function activateBoxTab(boxName) {
            document.querySelectorAll('.box-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.box === boxName) {
                    tab.classList.add('active');
                }
            });
            showBoxContent(boxName);
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('result').classList.remove('active');
            document.getElementById('errorMessage').style.display = 'block';
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').classList.remove('active');
            document.getElementById('errorMessage').style.display = 'none';
        }

        // æ·»åŠ æœ€è¿‘æœç´¢è®°å½•
        function addToRecentSearches(colorCode) {
            const popularContainer = document.getElementById('popularColors');
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            const existing = Array.from(popularContainer.children).find(
                child => child.textContent === colorCode
            );
            
            if (!existing) {
                const tag = document.createElement('div');
                tag.className = 'search-tag';
                tag.textContent = colorCode;
                tag.onclick = () => {
                    document.getElementById('colorInput').value = colorCode;
                    searchColor();
                };
                
                popularContainer.insertBefore(tag, popularContainer.firstChild);
                
                // é™åˆ¶æœ€å¤šæ˜¾ç¤º15ä¸ª
                if (popularContainer.children.length > 15) {
                    popularContainer.removeChild(popularContainer.lastChild);
                }
            }
        }

        // åˆå§‹åŒ–å¸¸ç”¨è‰²å·
        function initializePopularColors() {
            const popularContainer = document.getElementById('popularColors');
            POPULAR_COLORS.forEach(colorCode => {
                const tag = document.createElement('div');
                tag.className = 'search-tag';
                tag.textContent = colorCode;
                tag.onclick = () => {
                    document.getElementById('colorInput').value = colorCode;
                    searchColor();
                };
                popularContainer.appendChild(tag);
            });
        }

        // æœç´¢è‰²å·
        function searchColor() {
            const input = document.getElementById('colorInput').value;
            if (!input.trim()) return;
            
            showLoading();
            
            setTimeout(() => {
                const colorCode = parseColorInput(input);
                if (colorCode) {
                    showColorResult(colorCode);
                } else {
                    showError();
                }
            }, 300);
        }

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            initializeColorDatabase();
            initializeBoxTabs();
            initializePopularColors();
            
            // è®¾ç½®æœç´¢æŒ‰é’®äº‹ä»¶
            document.getElementById('searchBtn').addEventListener('click', searchColor);
            
            // è®¾ç½®å›è½¦é”®æœç´¢
            document.getElementById('colorInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchColor();
                }
            });
            
            // é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€ä¸ªè‰²å·
            document.getElementById('colorInput').value = 'B10';
            searchColor();
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>